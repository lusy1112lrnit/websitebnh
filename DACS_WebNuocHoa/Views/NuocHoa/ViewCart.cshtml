@using DACS_WebNuocHoa.Models
@using System.Linq
@{
    ViewBag.Title = "Giỏ Hàng";
    Layout = "~/Views/Shared/_LayoutNuocHoaStore.cshtml";
    var info = System.Globalization.CultureInfo.GetCultureInfo("vi-VN");

}


<h3>Giỏ của bạn</h3>
<table cellpadding="2" cellspacing="2" border="1">
    <tr>
        <th>Chọn</th>
        <th>Mã</th>
        <th>Tên</th>
        <th>Hình</th>
        <th>Giá</th>
        <th>Số Lượng</th>
        <th>Thành Tiền</th>
    </tr>

    @if (Session["cart"] != null)
    {
        foreach (CartItem item in (List<CartItem>)Session["cart"])
        {
            <tr>
                <td><a href="@Url.Action("RemoveCart", "NuocHoa", new { id = item.NuocHoa.MaNH })">Xóa</a></td>
                <td>@item.NuocHoa.MaNH</td>
                <td>@item.NuocHoa.TenNH</td>
                <td><img src="@item.NuocHoa.Hinh" style="width:60; height:auto;" /> </td>
                <td>@String.Format(info, "{0:N0}", item.NuocHoa.Gia)</td>
                <td>
                    <form action="/NuocHoa/UpdateCart" method="post">
                        <input type="number" min="1" name="quantity" value="@item.Quantity" />
                        <input type="hidden" name="productId" value="@item.NuocHoa.MaNH" />
                        <input type="submit" value="Update" />
                    </form>
                </td>
                <td>@String.Format(info, "{0:N0}", (item.NuocHoa.Gia * item.Quantity))</td>
            </tr>
        }
        <tr>
            <td align="right" colspan="6">Tổng</td>
            <td>
                @{
                    List<CartItem> cart = (List<CartItem>)Session["cart"];
                    var total = cart.Sum(item => item.NuocHoa.Gia * item.Quantity);
                    var gia = @String.Format(info, "{0:N0} đ", total);
                }
                @gia
            </td>
        </tr>
    }
    else
    {
        {
            <script>
                alert("Giỏ hàng không có sản phẩm - Quay lại và tiếp tục mua sắm !!!");
                window.history.back();
            </script>
        }
    }

</table>
<br />
<div style="display: inline-block;">
    <ul>
        <li style="display:inline-block; margin-right:400px;"></li>
        <li style="display: inline-block; font-size: 15; font-weight: bold;">Hình thức thanh toán :</li>
        <li style="display: inline-block">
            <select title="Chọn hình thức thanh toán" id="shippingMethod">
                <option value="cod">Tiền mặt</option>
                <option value="paypal">Paypal</option>
            </select>
        </li>
        <li style="display: inline-block">
            <a href="#" class="btn btn-success" id="placeOrderBtn">Đặt hàng</a>
        </li>
    </ul>
</div>
<br /><br />
<a href="/NuocHoa/Index" class="btn btn-primary">Quay lại mua sắm</a>

<script>
    
    document.getElementById("placeOrderBtn").addEventListener("click", function (e) {
        e.preventDefault();

        var shippingMethod = document.getElementById("shippingMethod").value;

        if (shippingMethod === "cod") {
            window.location.href = "/NuocHoa/Order";
        } else if (shippingMethod === "paypal") {
            window.location.href = "/ShoppingCart/PaymentWithPaypal";
        }
    });
</script>